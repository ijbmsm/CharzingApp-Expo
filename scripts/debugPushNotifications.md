# 푸시 알림 문제 진단 가이드

## 🔍 본인에게만 푸시 알림이 오는 문제 해결

### 1. 다른 사용자들의 테스트 환경 확인

#### ✅ 체크리스트:
- [ ] **실제 디바이스**에서 테스트하고 있는가? (시뮬레이터 X)
- [ ] 앱 첫 실행 시 **푸시 알림 권한을 허용**했는가?
- [ ] 로그인 후 홈화면까지 정상적으로 도달했는가?

#### 📱 실제 디바이스 테스트 필수:
```bash
# iOS 시뮬레이터에서는 푸시 토큰이 생성되지 않음
# Android 에뮬레이터에서도 푸시 토큰이 생성되지 않을 수 있음
```

### 2. 앱 로그 확인

#### 로그인 시 다음 메시지들이 나와야 함:
```
✅ Expo 푸시 토큰 생성 성공: ExponentPushToken[xxxxxx]
📱 사용자 로그인 완료, 푸시 알림 등록 및 인앱 알림 불러오기 중...
✅ 푸시 토큰 저장 완료
```

#### 만약 다음 메시지가 나온다면:
```
⚠️  EAS projectId가 설정되지 않았습니다.
푸시 알림 권한이 거부되었습니다.
❌ 시뮬레이터에서는 푸시 토큰을 생성할 수 없습니다.
```

### 3. Firebase Console 직접 확인

#### 방법:
1. Firebase Console > Cloud Messaging 접속
2. "새 메시지" 클릭
3. 특정 기기 타겟팅 선택
4. 다른 사용자의 FCM 토큰으로 직접 전송 테스트

### 4. 관리자 도구에서 사용자 목록 확인

#### charzing-admin에서 확인해야 할 것:
- 사용자별 푸시 토큰 등록 상태
- 토큰 형식: `ExponentPushToken[...]` 형태여야 함
- 알림 설정 활성화 여부

### 5. 즉시 해결 방법

#### 다른 사용자들에게 요청:
1. **앱 완전히 삭제** 후 재설치
2. **실제 디바이스**에서 실행
3. 로그인 시 **알림 권한 허용** 필수
4. 홈화면 도달 후 잠시 대기 (토큰 등록 시간)

#### 토큰 등록 강제 실행 (개발자용):
```javascript
// App.tsx의 NotificationInitializer에서
// 사용자 로그인 완료 시 강제로 토큰 재등록
notificationService.registerForPushNotifications(user.uid)
```

### 6. 코드 레벨 해결

#### notificationService.ts 수정:
```typescript
// 시뮬레이터 감지 및 경고 강화
if (!Device.isDevice) {
  Alert.alert(
    '푸시 알림 불가', 
    '실제 디바이스에서만 푸시 알림을 받을 수 있습니다.\n시뮬레이터에서는 푸시 알림이 작동하지 않습니다.'
  );
  return null;
}
```

### 7. 관리자 전송 로직 확인

#### Firebase Functions 확인:
- `sendPushNotificationAdmin` 함수에서 올바른 사용자 ID 배열 전송 여부
- 각 사용자별 푸시 토큰 조회 성공 여부
- Expo Push API 호출 성공 여부

### 💡 즉시 테스트 방법:

1. **본인 외 다른 사용자 1명**을 실제 디바이스에서 테스트
2. 해당 사용자가 **로그인 완료 후** 관리자 도구에서 **개별 전송** 테스트
3. 받으면 성공, 못 받으면 위 체크리스트 확인

### 🚨 가장 흔한 실수:
- **시뮬레이터 사용**: 99% 이것이 원인
- **권한 거부**: 앱 첫 실행 시 알림 권한 거부
- **로그인 미완료**: 홈화면까지 도달하지 않음